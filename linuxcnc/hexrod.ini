# hexrod-cnc LinuxCNC Configuration Example
# ==========================================
# Mesa 7C81 (hm2_rpspi) on Raspberry Pi
# Axes: X (length), Z (depth/radius), A (dividing head, optional)
#
# Copy and adapt to your machine. Adjust SCALE values to match
# your stepper motors, microstepping, and mechanical ratios.

[EMC]
MACHINE = hexrod-cnc
VERSION = 1.1

[DISPLAY]
DISPLAY = axis
CYCLE_TIME = 0.100
POSITION_OFFSET = RELATIVE
POSITION_FEEDBACK = ACTUAL
MAX_FEED_OVERRIDE = 2.0
MAX_SPINDLE_OVERRIDE = 1.0
DEFAULT_LINEAR_VELOCITY = 5
MAX_LINEAR_VELOCITY = 50
DEFAULT_ANGULAR_VELOCITY = 90
MAX_ANGULAR_VELOCITY = 360

[FILTER]
PROGRAM_EXTENSION = .ngc G-Code

[TASK]
TASK = milltask
CYCLE_TIME = 0.010

[RS274NGC]
PARAMETER_FILE = linuxcnc.var

[EMCMOT]
EMCMOT = motmod
COMM_TIMEOUT = 1.0
SERVO_PERIOD = 1000000

[HOSTMOT2]
# Mesa 7C81 on Raspberry Pi via SPI
DRIVER = hm2_rpspi
BOARD = 7c81
CONFIG = "num_encoders=0 num_pwmgens=0 num_stepgens=3"
# Set to 4 if A-axis is used: num_stepgens=4

[HAL]
HALFILE = hexrod.hal
POSTGUI_HALFILE = postgui.hal

[TRAJ]
AXES = 3               # set to 4 if using A-axis
COORDINATES = X Z      # set to "X Z A" if using A-axis
HOME = 0 0
LINEAR_UNITS = mm
ANGULAR_UNITS = degree
DEFAULT_LINEAR_VELOCITY = 5
MAX_LINEAR_VELOCITY = 50
DEFAULT_ACCELERATION = 200
MAX_ACCELERATION = 500
NO_FORCE_HOMING = 1

# ─── X AXIS ───────────────────────────────────────────────────────────────────
[AXIS_X]
MIN_LIMIT = -1.0
MAX_LIMIT = 1600.0
MAX_VELOCITY = 50
MAX_ACCELERATION = 300

[JOINT_0]
TYPE = LINEAR
HOME = 0.0
MIN_LIMIT = -1.0
MAX_LIMIT = 1600.0
MAX_VELOCITY = 50
MAX_ACCELERATION = 300
# SCALE = steps_per_mm
# Example: 200 steps/rev * 16 microsteps / 5mm lead = 640 steps/mm
SCALE = 640
STEPLEN = 1000
STEPSPACE = 1000
DIRHOLD = 2000
DIRSETUP = 2000
HOME_SEARCH_VEL = -5
HOME_LATCH_VEL = 1
HOME_SEQUENCE = 0

# ─── Z AXIS ───────────────────────────────────────────────────────────────────
[AXIS_Z]
MIN_LIMIT = -50.0
MAX_LIMIT = 5.0
MAX_VELOCITY = 20
MAX_ACCELERATION = 200

[JOINT_1]
TYPE = LINEAR
HOME = 0.0
MIN_LIMIT = -50.0
MAX_LIMIT = 5.0
MAX_VELOCITY = 20
MAX_ACCELERATION = 200
SCALE = 640
STEPLEN = 1000
STEPSPACE = 1000
DIRHOLD = 2000
DIRSETUP = 2000
HOME_SEARCH_VEL = 3
HOME_LATCH_VEL = 0.5
HOME_SEQUENCE = 1

# ─── A AXIS (DIVIDING HEAD) ───────────────────────────────────────────────────
# Uncomment and adapt when A-axis is installed.
#
# SCALE calculation:
#   SCALE = (motor_steps * microsteps * gear_ratio) / 360
#   Example: 200 * 16 * 18 / 360 = 160  (18:1 worm gear)
#            200 * 16 *  1 / 360 = 8.89 (direct drive)

#[AXIS_A]
#TYPE = ANGULAR
#MAX_VELOCITY = 360
#MAX_ACCELERATION = 720
#WRAPPED_ROTARY = 1        # 1 = indexing (polygon), 0 = continuous turning

#[JOINT_2]
#TYPE = ANGULAR
#HOME = 0.0
#MAX_VELOCITY = 360
#MAX_ACCELERATION = 720
#SCALE = 160               # adjust to your setup
#STEPLEN = 1000
#STEPSPACE = 1000
#DIRHOLD = 2000
#DIRSETUP = 2000
#HOME_SEQUENCE = -1        # no homing needed with WRAPPED_ROTARY
